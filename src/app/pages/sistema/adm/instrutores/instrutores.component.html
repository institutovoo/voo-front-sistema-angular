<app-sistema-layout [usuario]="{ nome: usuarioLogado()?.nome_completo || 'Administrador' }" tipoUsuario="admin">
  <div class="gestao-instrutores">
    <div class="gestao-instrutores__header">
      <div>
        <h1 class="gestao-instrutores__titulo">Gestão de Instrutores</h1>
        <p class="gestao-instrutores__subtitulo">Gerencie parceiros, comissões e novos cadastros</p>
      </div>
    </div>

    <!-- Filtros -->
    <div class="gestao-instrutores__filtros">
      <div class="busca">
        <app-header-icone nome="busca" [tamanho]="18"></app-header-icone>
        <input type="text" 
               placeholder="Buscar por nome ou e-mail..." 
               [ngModel]="busca()" 
               (ngModelChange)="setBusca($event)" />
      </div>
      <div class="opcoes">
        <select class="select-filtro" [ngModel]="filtroStatus()" (ngModelChange)="setFiltroStatus($event)">
          <option value="todos">Todos os status</option>
          <option value="ativo">Ativos</option>
          <option value="analise">Em Análise</option>
        </select>
      </div>
    </div>

    <div class="tabela-container">
      @if (carregando()) {
        <div class="loading-overlay">
          <p>Carregando instrutores...</p>
        </div>
      }
      @if (!carregando()) {
        <table class="tabela">
          <thead>
            <tr>
              <th>Instrutor</th>
              <th>Perfis</th>
              <th>Comissão (%)</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            @for (inst of instrutoresFiltrados(); track inst.cpf_cnpj) {
              <tr>
                <td>
                  <div class="inst-info">
                    <div class="inst-info__avatar">{{ inst.nome_completo?.charAt(0) }}</div>
                    <div>
                      <div class="inst-info__header">
                        <p class="inst-info__nome">{{ inst.nome_completo }}</p>
                        @if (ehUsuarioLogado(inst)) {
                          <span class="badge-voce">Você</span>
                        }
                      </div>
                      <p class="inst-info__email">{{ inst.email }}</p>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="perfis-lista">
                    @for (perfil of inst.perfis; track perfil) {
                      <span class="badge-tipo" 
                            [class.badge-tipo--aluno]="perfil === 'Aluno'"
                            [class.badge-tipo--instrutor]="perfil.includes('Instrutor')"
                            [class.badge-tipo--adm]="perfil === 'Admin'">
                        {{ perfil }}
                      </span>
                    }
                  </div>
                </td>
                <td>{{ inst.comissao || 70 }}%</td>
                <td>
                  <span class="badge-status" [class]="'badge-status--' + (inst.status || 'ativo')">
                    {{ (inst.status || 'ativo') === 'ativo' ? 'Ativo' : 'Em Análise' }}
                  </span>
                </td>
                <td>
                  <div class="acoes-btns">
                    <button class="btn-acao" title="Ver Detalhes"><app-header-icone nome="olho" [tamanho]="16"></app-header-icone></button>
                    <button class="btn-acao btn-acao--excluir" title="Remover"><app-header-icone nome="lixeira" [tamanho]="16"></app-header-icone></button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      }
    </div>
  </div>
</app-sistema-layout>
