<app-sistema-layout [usuario]="usuario" tipoUsuario="aluno" conteudoMaxWidth="1400px">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a routerLink="/aluno/meus-cursos" class="breadcrumb__link">
      <app-header-icone nome="seta-esquerda" [tamanho]="16"></app-header-icone>
      Meus cursos
    </a>
    <span class="breadcrumb__separator">/</span>
    <span class="breadcrumb__atual">{{ curso.titulo }}</span>
  </div>

  <div class="curso-detalhe">
    <!-- Coluna Principal -->
    <div class="curso-detalhe__principal">
      <!-- Header do Curso -->
      <div class="curso-header">
        <div class="curso-header__video">
          <img [src]="curso.imagem" [alt]="curso.titulo" class="curso-header__thumb" />
          <button class="curso-header__play" (click)="continuarCurso()">
            <app-header-icone nome="play" [tamanho]="32"></app-header-icone>
          </button>
        </div>
      </div>

      <!-- Info Mobile (só aparece em mobile) -->
      <div class="curso-info-mobile">
        <span class="curso-info-mobile__categoria" [style.background-color]="curso.categoriaColor">
          {{ curso.categoria }}
        </span>
        <h1 class="curso-info-mobile__titulo">{{ curso.titulo }}</h1>
        <p class="curso-info-mobile__descricao">{{ curso.descricao }}</p>

        <div class="curso-info-mobile__stats">
          <span class="stat">
            <app-header-icone
              nome="star"
              [tamanho]="16"
              preenchimento="#f59e0b"
              cor="none"
            ></app-header-icone>
            {{ curso.avaliacao }} ({{ curso.totalAvaliacoes }} avaliações)
          </span>
          <span class="stat">
            <app-header-icone nome="usuarios" [tamanho]="16"></app-header-icone>
            {{ curso.totalAlunos | number }} alunos
          </span>
        </div>
      </div>

      <!-- Progresso do Curso -->
      <div class="curso-progresso" *ngIf="inscrito()">
        <div class="curso-progresso__header">
          <h3>Seu progresso</h3>
          <span class="curso-progresso__percent">{{ progresso }}% concluído</span>
        </div>
        <app-barra-progresso
          [valor]="progresso"
          tamanho="medio"
          [cor]="progresso === 100 ? '#22c55e' : '#21b7cd'"
        ></app-barra-progresso>
        <p class="curso-progresso__info">
          {{ totalAulasConcluidas }} de {{ totalAulas }} aulas concluídas
        </p>
      </div>

      <!-- Lista de Módulos -->
      <div class="modulos">
        <h2 class="modulos__titulo">Conteúdo do curso</h2>
        <p class="modulos__subtitulo">
          {{ curso.modulos.length }} módulos • {{ totalAulas }} aulas • {{ curso.duracao }} de
          conteúdo
        </p>

        <div class="modulos__lista">
          <div
            *ngFor="let modulo of curso.modulos; let i = index"
            class="modulo"
            [class.modulo--expandido]="modulo.expandido"
            [class.modulo--concluido]="isModuloConcluido(modulo)"
          >
            <!-- Header do Módulo -->
            <button class="modulo__header" (click)="toggleModulo(modulo)">
              <div class="modulo__info">
                <span
                  class="modulo__numero"
                  [class.modulo__numero--concluido]="isModuloConcluido(modulo)"
                  [class.modulo__numero--em-progresso]="
                    !isModuloConcluido(modulo) && getAulasConcluidas(modulo) > 0
                  "
                >
                  <app-header-icone
                    *ngIf="isModuloConcluido(modulo)"
                    nome="check"
                    [tamanho]="14"
                    cor="#fff"
                  ></app-header-icone>
                  <span *ngIf="!isModuloConcluido(modulo)">{{ i + 1 }}</span>
                </span>
                <div class="modulo__texto">
                  <h4 class="modulo__titulo">{{ modulo.titulo }}</h4>
                  <span class="modulo__meta">
                    {{ getAulasConcluidas(modulo) }}/{{ modulo.aulas.length }} aulas concluídas
                  </span>
                </div>
              </div>
              <app-header-icone
                [nome]="modulo.expandido ? 'seta-cima' : 'seta-baixo'"
                [tamanho]="20"
              ></app-header-icone>
            </button>

            <!-- Lista de Aulas -->
            <div class="modulo__aulas" *ngIf="modulo.expandido">
              <div
                *ngFor="let aula of modulo.aulas"
                class="aula"
                [class.aula--concluida]="aula.concluida"
                [class.aula--bloqueada]="aula.bloqueada"
                (click)="acessarAula(aula)"
              >
                <span class="aula__icone" [class.aula__icone--concluida]="aula.concluida">
                  <app-header-icone
                    [nome]="getAulaIcone(aula)"
                    [tamanho]="16"
                    [cor]="aula.concluida ? '#22c55e' : '#64748b'"
                  ></app-header-icone>
                </span>
                <span class="aula__titulo">{{ aula.titulo }}</span>
                <span class="aula__duracao">{{ aula.duracao }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="curso-detalhe__sidebar">
      <div class="sidebar-card">
        <!-- Preço -->
        <div class="sidebar-card__preco">
          <span *ngIf="curso.gratuito" class="sidebar-card__preco-gratis">Gratuito</span>
          <ng-container *ngIf="!curso.gratuito">
            <span class="sidebar-card__preco-valor">R$ {{ curso.preco | number : '1.2-2' }}</span>
            <span *ngIf="curso.precoOriginal" class="sidebar-card__preco-original">
              R$ {{ curso.precoOriginal | number : '1.2-2' }}
            </span>
          </ng-container>
        </div>

        <!-- Botão Principal -->
        <button class="btn btn--primary btn--block" *ngIf="!inscrito()" (click)="inscreverCurso()">
          {{ curso.gratuito ? 'Inscrever-se grátis' : 'Comprar curso' }}
        </button>

        <button class="btn btn--success btn--block" *ngIf="inscrito()" (click)="continuarCurso()">
          <app-header-icone nome="play" [tamanho]="18"></app-header-icone>
          Continuar assistindo
        </button>

        <!-- O que está incluso -->
        <div class="sidebar-card__inclui">
          <h4>Este curso inclui:</h4>
          <ul class="sidebar-card__lista">
            <li *ngFor="let item of curso.inclui">
              <app-header-icone nome="check" [tamanho]="14" cor="#22c55e"></app-header-icone>
              {{ item }}
            </li>
          </ul>
        </div>

        <!-- Informações -->
        <div class="sidebar-card__info">
          <div class="info-item">
            <app-header-icone nome="cursos" [tamanho]="18"></app-header-icone>
            <div>
              <span class="info-item__label">Aulas</span>
              <span class="info-item__valor">{{ totalAulas }} aulas</span>
            </div>
          </div>
          <div class="info-item">
            <app-header-icone nome="relogio" [tamanho]="18"></app-header-icone>
            <div>
              <span class="info-item__label">Duração</span>
              <span class="info-item__valor">{{ curso.duracao }}</span>
            </div>
          </div>
          <div class="info-item">
            <app-header-icone nome="grafico" [tamanho]="18"></app-header-icone>
            <div>
              <span class="info-item__label">Nível</span>
              <span class="info-item__valor">{{ getNivelLabel(curso.nivel) }}</span>
            </div>
          </div>
          <div class="info-item" *ngIf="curso.certificado">
            <app-header-icone nome="certificados" [tamanho]="18"></app-header-icone>
            <div>
              <span class="info-item__label">Certificado</span>
              <span class="info-item__valor">incluso</span>
            </div>
          </div>
          <div class="info-item">
            <app-header-icone nome="calendario" [tamanho]="18"></app-header-icone>
            <div>
              <span class="info-item__label">Atualizado</span>
              <span class="info-item__valor">{{ formatarData(curso.atualizado) }}</span>
            </div>
          </div>
        </div>

        <!-- Instrutor -->
        <div class="sidebar-card__instrutor">
          <h4>Instrutor</h4>
          <div class="instrutor">
            <img
              [src]="curso.instrutor.avatar"
              [alt]="curso.instrutor.nome"
              class="instrutor__avatar"
            />
            <div class="instrutor__info">
              <span class="instrutor__label">Instrutor</span>
              <span class="instrutor__nome">{{ curso.instrutor.nome }}</span>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</app-sistema-layout>
