<!-- Overlay Mobile -->
<div class="header-overlay" *ngIf="menuMobileAberto" (click)="fecharMenuMobile()"></div>

<!-- Header Principal -->
<header class="header">
  <div class="header__left">
    <!-- Logo -->
    <app-logo [linkHome]="'/' + tipoUsuario + '/dashboard'" tema="light" class="header__logo"></app-logo>

    <!-- Botão Menu Mobile -->
    <button class="header__menu-mobile" (click)="toggleMenuMobile()">
      <app-header-icone nome="menu" [tamanho]="24"></app-header-icone>
    </button>

    <!-- Menu Horizontal (Desktop) -->
    <nav class="header__nav">
      <app-header-menu-item
        *ngFor="let item of menuPrincipal"
        [item]="item"
        [compacto]="false"
        class="header__nav-item"
      ></app-header-menu-item>
    </nav>
  </div>

  <!-- Ações -->
  <div class="header__acoes">
    <!-- Profile Switcher -->
    <div class="header__perfil" *ngIf="usuarioLogado()">
      <button 
        class="header__perfil-trigger" 
        (click)="toggleMenuPerfil($event)"
        [ngClass]="{'header__perfil-trigger--aberto': menuPerfilAberto}"
      >
        <app-header-icone [nome]="perfilAtual()?.toLowerCase()?.includes('instrutor') ? 'usuario' : 'usuario'" [tamanho]="18"></app-header-icone>
        <span>{{ perfilAtual() }}</span>
        <app-header-icone nome="seta-baixo" [tamanho]="14" class="header__usuario-seta" [class.header__usuario-seta--aberta]="menuPerfilAberto"></app-header-icone>
      </button>

      <div class="header__dropdown header__dropdown--perfil" *ngIf="menuPerfilAberto">
        <div class="header__dropdown-header">
          <span class="header__dropdown-label">ALTERNAR PARA</span>
        </div>
        <div class="header__dropdown-body">
          <ng-container *ngFor="let perfil of usuarioLogado()?.perfis">
            <button 
              *ngIf="perfil !== perfilAtual()"
              class="header__dropdown-item" 
              (click)="alternarPerfil(perfil)"
            >
              <app-header-icone [nome]="perfil.toLowerCase().includes('instrutor') ? 'usuario' : 'usuario'" [tamanho]="18"></app-header-icone>
              {{ perfil }}
            </button>
          </ng-container>
          
          <div class="header__dropdown-divider"></div>
          
          <button class="header__dropdown-item" (click)="abrirModalNovoPerfil()">
            <div class="header__dropdown-icone-plus">+</div>
            Criar novo perfil
          </button>
        </div>
      </div>
    </div>

    <!-- Perfil do Usuário com Dropdown -->
    <div class="header__usuario">
      <button class="header__usuario-trigger" (click)="toggleMenuUsuario()">
        <app-header-usuario-avatar
          [nome]="usuarioLogado()?.nome_completo || usuario.nome"
          [avatar]="usuario.avatar"
          [mostrarNome]="false"
        ></app-header-usuario-avatar>
        <app-header-icone
          [nome]="'seta-baixo'"
          [tamanho]="14"
          [class.header__usuario-seta--aberta]="menuUsuarioAberto"
          class="header__usuario-seta"
        ></app-header-icone>
      </button>

      <!-- Dropdown de Usuário -->
      <div class="header__dropdown" *ngIf="menuUsuarioAberto">
        <div class="header__dropdown-header">
          <span class="header__dropdown-nome">{{ usuarioLogado()?.nome_completo || usuario.nome }}</span>
          <span class="header__dropdown-email" *ngIf="usuarioLogado()?.email || usuario.email">{{ usuarioLogado()?.email || usuario.email }}</span>
        </div>

        <div class="header__dropdown-body">
          <a
            [routerLink]="['/' + tipoUsuario + '/configuracoes']"
            class="header__dropdown-item"
            (click)="fecharMenuUsuario()"
          >
            <app-header-icone nome="config" [tamanho]="18"></app-header-icone>
            <span>Configurações</span>
          </a>

          <div class="header__dropdown-divider"></div>

          <button class="header__dropdown-item header__dropdown-item--sair" (click)="onLogout()">
            <app-header-icone nome="sair" [tamanho]="18"></app-header-icone>
            <span>Sair da conta</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Modal Novo Perfil -->
<app-modal-novo-perfil
  *ngIf="modalNovoPerfilAberto"
  [perfilAtual]="perfilAtual()"
  [perfisExistentes]="usuarioLogado()?.perfis || []"
  [documentos]="usuarioLogado()?.documentos || []"
  (fechar)="modalNovoPerfilAberto = false"
  (criar)="aoCriarPerfil($event)"
></app-modal-novo-perfil>

<!-- Menu Mobile (Gaveta Lateral) -->
<aside class="mobile-nav" [class.mobile-nav--aberto]="menuMobileAberto">
  <div class="mobile-nav__header">
    <app-logo [linkHome]="'/' + tipoUsuario + '/dashboard'" tema="light"></app-logo>
    <button class="mobile-nav__fechar" (click)="fecharMenuMobile()">
      <app-header-icone nome="x" [tamanho]="24"></app-header-icone>
    </button>
  </div>

  <nav class="mobile-nav__corpo">
    <app-header-menu-item
      *ngFor="let item of menuPrincipal"
      [item]="item"
      [compacto]="false"
      (itemClick)="fecharMenuMobile()"
    ></app-header-menu-item>
  </nav>

  <div class="mobile-nav__footer">
    <button class="mobile-nav__item mobile-nav__item--sair" (click)="onLogout()">
      <app-header-icone nome="sair" [tamanho]="20"></app-header-icone>
      <span>Sair</span>
    </button>
  </div>
</aside>
